name: Smart Daily Activity

on:
  schedule:
    - cron: "0 */4 * * *"   # ÙŠØ¹Ù…Ù„ ÙƒÙ„ 4 Ø³Ø§Ø¹Ø§Øª (6 Ù…Ø±Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹)
  workflow_dispatch:

permissions:
  contents: write

jobs:
  smart-activity:
    runs-on: ubuntu-latest

    steps:
      # ðŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          persist-credentials: true
          fetch-depth: 0

      # ðŸ§  Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø°ÙƒÙŠ
      - name: Generate smart activity log
        run: |
          set -e

          PROJECT="${GITHUB_REPOSITORY##*/}"
          DAY="$(date -u +%A)"
          WEEK="$(date -u +%V)"
          DATE="$(date -u '+%Y-%m-%d %H:%M:%S UTC')"

          FILE="activity-week-${WEEK}.log"
          COUNTER_FILE=".run-counter"

          # ðŸ”¢ Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ´ØºÙŠÙ„
          if [ ! -f "$COUNTER_FILE" ]; then
            echo "0" > "$COUNTER_FILE"
          fi

          RUN_COUNT=$(($(cat "$COUNTER_FILE") + 1))
          echo "$RUN_COUNT" > "$COUNTER_FILE"

          # ðŸ“Š Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ commits
          COMMITS=$(git rev-list --count HEAD || echo 0)

          if [ "$COMMITS" -lt 20 ]; then
            STATUS="Early Development"
            TAG="research"
          elif [ "$COMMITS" -lt 100 ]; then
            STATUS="Active Development"
            TAG="dev"
          else
            STATUS="Stabilization & Cleanup"
            TAG="cleanup"
          fi

          # ðŸ“… Ù…Ù„Ø®Øµ Ø£Ø³Ø¨ÙˆØ¹ÙŠ ÙŠÙˆÙ… Ø§Ù„Ø£Ø­Ø¯
          SUMMARY=""
          if [ "$DAY" = "Sunday" ]; then
            WEEK_COMMITS=$(git rev-list --count --since="7 days ago" HEAD || echo 0)
            SUMMARY="Weekly commits: $WEEK_COMMITS"
          fi

          # ðŸ” Ø¥Ù†Ø´Ø§Ø¡ hash
          SIGN_DATA="$PROJECT|$STATUS|$RUN_COUNT|$DATE"
          HASH=$(echo "$SIGN_DATA" | sha256sum | cut -d' ' -f1)

          # ðŸ“ ÙƒØªØ§Ø¨Ø© log
          {
            echo ""
            echo "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ"
            echo "â–ˆ   SMART ACTIVITY SYSTEM v2.0     â–ˆ"
            echo "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ"
            echo " Project : $PROJECT"
            echo " Status  : $STATUS"
            echo " Tag     : #$TAG"
            echo " Commits : $COMMITS"
            echo " Run     : #$RUN_COUNT"
            echo " Day     : $DAY"
            echo " Week    : #$WEEK"
            echo " Time    : $DATE"
            [ -n "$SUMMARY" ] && echo " Summary : $SUMMARY"
            echo " Hash    : $HASH"
            echo " User    : besam11alukadi"
            echo "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ"
          } >> "$FILE"

      # ðŸš€ Ø¹Ù…Ù„ commit Ùˆ push ØªÙ„Ù‚Ø§Ø¦ÙŠ
      - name: Commit & push changes
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          git config user.name "besam11alukadi"
          git config user.email "190636572+besam11alukadi@users.noreply.github.com"

          git add .

          if git diff --cached --quiet; then
            echo "No changes to commit."
            exit 0
          fi

          git commit -m "chore: smart automated activity ðŸ¤–"
          git push "https://x-access-token:${GH_TOKEN}@github.com/${{ github.repository }}.git" HEAD:main
